One thing I learned from doing this is that there is no better time for refactoring code than NOW.
The code quickly got overlycomplicated and I should have better taken the time for structuring it.